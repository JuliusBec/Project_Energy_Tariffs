nohup: ignoring input
INFO:     Will watch for changes in these directories: ['/workspaces/Project_Energy_Tariffs']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [101323] using StatReload
INFO:     Started server process [101328]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     127.0.0.1:39894 - "POST /api/scraper-data HTTP/1.1" 404 Not Found
GET /api/tariffs called
Returning 6 tariffs
INFO:     84.167.128.237:0 - "GET /api/tariffs HTTP/1.1" 200 OK
INFO:     84.167.128.237:0 - "GET / HTTP/1.1" 200 OK
14:27:40 - cmdstanpy - INFO - Chain [1] start processing
14:27:41 - cmdstanpy - INFO - Chain [1] done processing
14:27:42 - cmdstanpy - INFO - Chain [1] start processing
14:27:42 - cmdstanpy - INFO - Chain [1] done processing
14:27:43 - cmdstanpy - INFO - Chain [1] start processing
14:27:43 - cmdstanpy - INFO - Chain [1] done processing
14:27:45 - cmdstanpy - INFO - Chain [1] start processing
14:27:46 - cmdstanpy - INFO - Chain [1] done processing
14:27:48 - cmdstanpy - INFO - Chain [1] start processing
14:27:48 - cmdstanpy - INFO - Chain [1] done processing
14:27:50 - cmdstanpy - INFO - Chain [1] start processing
14:27:50 - cmdstanpy - INFO - Chain [1] done processing

================================================================================
UPLOADED CSV FILE: user_data_53270.csv
Data shape: (35140, 3)
Date range: 2023-11-01 00:15:00 to 2024-11-01 00:00:00
Total consumption: 4350.95 kWh
Time span: 1.00 years
Extrapolated annual consumption: 4350.95 kWh
Average hourly consumption: 0.4953 kWh
First 5 rows:
             datetime  value status
0 2023-11-01 00:15:00  0.042      W
1 2023-11-01 00:30:00  0.022      W
2 2023-11-01 00:45:00  0.020      W
3 2023-11-01 01:00:00  0.016      W
4 2023-11-01 01:15:00  0.014      W
================================================================================

Created 6 tariffs
Processing tariff: EnBW mobility+ dynamic, is_dynamic: True
Prophet forecast: 720 hours (30.0 days) of future data
Forecast range: 2024-11-01 01:00:00 to 2024-12-01 00:00:00
Forecast total consumption: 333.12 kWh
Total consumption: 333.1233944591461 kWh
Total consumption cost: 125.54392727722058‚Ç¨
Average kWh price: 0.3690‚Ç¨/kWh
Base price: 14.9‚Ç¨
Network fee (one-time): 18.0‚Ç¨
Total cost: 158.44392727722058‚Ç¨
Dynamic tariff - Cost: 158.44392727722058, Avg kWh price: 0.3690
Processing tariff: EnBW easy dynamic, is_dynamic: True
Prophet forecast: 720 hours (30.0 days) of future data
Forecast range: 2024-11-01 01:00:00 to 2024-12-01 00:00:00
Forecast total consumption: 333.12 kWh
Total consumption: 333.1233944591461 kWh
Total consumption cost: 125.54392727722058‚Ç¨
Average kWh price: 0.3690‚Ç¨/kWh
Base price: 9.9‚Ç¨
Network fee (one-time): 22.0‚Ç¨
Total cost: 157.44392727722058‚Ç¨
Dynamic tariff - Cost: 157.44392727722058, Avg kWh price: 0.3690
Processing tariff: EnBW mobility+ Zuhause, is_dynamic: False

================================================================================
FixedTariff.calculate_cost() called for tariff: EnBW mobility+ Zuhause
Data type: <class 'pandas.core.frame.DataFrame'>
DataFrame shape: (35140, 3)
DataFrame columns: ['datetime', 'value', 'status']
DataFrame date range: 2023-11-01 00:15:00 to 2024-11-01 00:00:00
Total consumption in uploaded data: 17403.80 kWh
================================================================================

Converted 15-minute kW readings to kWh (multiplied by 0.25)
After resampling to hourly: 8785 rows, total: 4350.95 kWh
Prophet forecast: 720 hours (30.0 days) of future data
Forecast range: 2024-11-01 01:00:00 to 2024-12-01 00:00:00
Forecast total consumption: 316.10 kWh
Fixed tariff - Cost: 119.18125894671927, kWh rate: 0.3299
Processing tariff: EnBW easy+, is_dynamic: False

================================================================================
FixedTariff.calculate_cost() called for tariff: EnBW easy+
Data type: <class 'pandas.core.frame.DataFrame'>
DataFrame shape: (35140, 3)
DataFrame columns: ['datetime', 'value', 'status']
DataFrame date range: 2023-11-01 00:15:00 to 2024-11-01 00:00:00
Total consumption in uploaded data: 17403.80 kWh
================================================================================

Converted 15-minute kW readings to kWh (multiplied by 0.25)
After resampling to hourly: 8785 rows, total: 4350.95 kWh
Prophet forecast: 720 hours (30.0 days) of future data
Forecast range: 2024-11-01 01:00:00 to 2024-12-01 00:00:00
Forecast total consumption: 316.10 kWh
Fixed tariff - Cost: 120.5032510016886, kWh rate: 0.3499
Processing tariff: EnBW Basis, is_dynamic: False

================================================================================
FixedTariff.calculate_cost() called for tariff: EnBW Basis
Data type: <class 'pandas.core.frame.DataFrame'>
DataFrame shape: (35140, 3)
DataFrame columns: ['datetime', 'value', 'status']
DataFrame date range: 2023-11-01 00:15:00 to 2024-11-01 00:00:00
Total consumption in uploaded data: 17403.80 kWh
================================================================================

Converted 15-minute kW readings to kWh (multiplied by 0.25)
After resampling to hourly: 8785 rows, total: 4350.95 kWh
Prophet forecast: 720 hours (30.0 days) of future data
Forecast range: 2024-11-01 01:00:00 to 2024-12-01 00:00:00
Forecast total consumption: 316.10 kWh
Fixed tariff - Cost: 129.82524305665794, kWh rate: 0.3699
Processing tariff: Komfort, is_dynamic: False

================================================================================
FixedTariff.calculate_cost() called for tariff: Komfort
Data type: <class 'pandas.core.frame.DataFrame'>
DataFrame shape: (35140, 3)
DataFrame columns: ['datetime', 'value', 'status']
DataFrame date range: 2023-11-01 00:15:00 to 2024-11-01 00:00:00
Total consumption in uploaded data: 17403.80 kWh
================================================================================

Converted 15-minute kW readings to kWh (multiplied by 0.25)
After resampling to hourly: 8785 rows, total: 4350.95 kWh
Prophet forecast: 720 hours (30.0 days) of future data
Forecast range: 2024-11-01 01:00:00 to 2024-12-01 00:00:00
Forecast total consumption: 316.10 kWh
Fixed tariff - Cost: 129.66424702917325, kWh rate: 0.3599
Final results: 6 tariffs calculated
INFO:     84.167.128.237:0 - "POST /api/calculate-with-csv HTTP/1.1" 200 OK
INFO:     127.0.0.1:41614 - "POST /api/scrape/tibber HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/workspaces/Project_Energy_Tariffs/app.py", line 1691, in scrape_tibber_tariff
    logger.info(f"üìû Tibber-Scraper API-Request: PLZ {request.zip_code}, {request.annual_consumption} kWh/Jahr")
    ^^^^^^
NameError: name 'logger' is not defined

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/fastapi/routing.py", line 125, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/fastapi/routing.py", line 111, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/fastapi/routing.py", line 391, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/fastapi/routing.py", line 290, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/Project_Energy_Tariffs/app.py", line 1727, in scrape_tibber_tariff
    logger.error(f"‚ùå Fehler beim Tibber-Scraping: {e}")
    ^^^^^^
NameError: name 'logger' is not defined
WARNING:  StatReload detected changes in 'app.py'. Reloading...
INFO:     84.167.128.237:0 - "POST /api/scrape/tariffs HTTP/1.1" 200 OK
INFO:     Shutting down
INFO:     127.0.0.1:57474 - "POST /api/scrape/tibber HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/workspaces/Project_Energy_Tariffs/app.py", line 1691, in scrape_tibber_tariff
    "debug_mode": false
    ^^^^^^
NameError: name 'logger' is not defined

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/fastapi/routing.py", line 125, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/fastapi/routing.py", line 111, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/fastapi/routing.py", line 391, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/fastapi/routing.py", line 290, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/Project_Energy_Tariffs/app.py", line 1727, in scrape_tibber_tariff
NameError: name 'logger' is not defined
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [101328]
INFO:     Started server process [103462]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     84.167.128.237:0 - "GET /api/forecast HTTP/1.1" 200 OK
INFO:     84.167.128.237:0 - "POST /api/predict-savings HTTP/1.1" 200 OK
INFO:     84.167.128.237:0 - "GET /api/forecast HTTP/1.1" 200 OK
INFO:app:üìû Tibber-Scraper API-Request: PLZ 68167, 3500 kWh/Jahr
ERROR:app:‚ùå Fehler beim Tibber-Scraping: TibberScraper() takes no arguments
INFO:     127.0.0.1:50084 - "POST /api/scrape/tibber HTTP/1.1" 500 Internal Server Error
WARNING:  StatReload detected changes in 'app.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [103462]
WARNING:  StatReload detected changes in 'app.py'. Reloading...
INFO:     Started server process [103965]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Started server process [104080]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:app:üìû Tibber-Scraper API-Request: PLZ 68167, 3500 kWh/Jahr
INFO:src.Webscraping.scraper_tibber:üîç Starting Tibber price lookup for PLZ 68167
INFO:src.Webscraping.scraper_tibber:üîß Starting Playwright scraping for PLZ 68167
ERROR:src.Webscraping.scraper_tibber:‚ùå Playwright scraping failed: It looks like you are using Playwright Sync API inside the asyncio loop.
Please use the Async API instead.
INFO:src.Webscraping.scraper_tibber:‚ö†Ô∏è Playwright scraping failed, using fallback data
INFO:src.Webscraping.scraper_tibber:üìä Using fallback prices for region 68
INFO:src.Webscraping.scraper_tibber:   Grundpreis: 16.09 ‚Ç¨/Monat
INFO:src.Webscraping.scraper_tibber:   Arbeitspreis: 15.25 ct/kWh
INFO:app:‚úÖ Tibber-Scraper erfolgreich: 87.26 ‚Ç¨/Monat
INFO:     127.0.0.1:60592 - "POST /api/scrape/tibber HTTP/1.1" 200 OK
WARNING:  StatReload detected changes in 'src/Webscraping/scraper_tibber.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [104080]
INFO:     Started server process [105056]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
WARNING:  StatReload detected changes in 'src/Webscraping/scraper_tibber.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [105056]
WARNING:  StatReload detected changes in 'src/Webscraping/scraper_tibber.py'. Reloading...
INFO:     Started server process [105263]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Started server process [105338]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
WARNING:  StatReload detected changes in 'src/Webscraping/scraper_tibber.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [105338]
INFO:     Started server process [105421]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
WARNING:  StatReload detected changes in 'src/Webscraping/scraper_tibber.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [105421]
WARNING:  StatReload detected changes in 'app.py'. Reloading...
INFO:     Started server process [105502]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
WARNING:  StatReload detected changes in 'app.py'. Reloading...
INFO:     Started server process [105577]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Started server process [105622]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:app:üìû Tibber-Scraper API-Request: PLZ 68167, 3500 kWh/Jahr
INFO:src.Webscraping.scraper_tibber:üîç Starting Tibber price lookup for PLZ 68167
INFO:src.Webscraping.scraper_tibber:üîß Starting Playwright scraping for PLZ 68167
INFO:src.Webscraping.scraper_tibber:üìç Loading https://tibber.com/de/preisrechner...
INFO:src.Webscraping.scraper_tibber:üç™ Accepting cookies...
INFO:src.Webscraping.scraper_tibber:‚úÖ Cookies accepted
INFO:src.Webscraping.scraper_tibber:üìù Entering PLZ: 68167
INFO:src.Webscraping.scraper_tibber:üìù Entering consumption: 3500 kWh
INFO:src.Webscraping.scraper_tibber:‚è≥ Waiting for price calculation...
INFO:src.Webscraping.scraper_tibber:üîç Opening price breakdown...
INFO:src.Webscraping.scraper_tibber:‚úÖ Price breakdown opened
INFO:src.Webscraping.scraper_tibber:‚úÖ Playwright scraping successful!
INFO:src.Webscraping.scraper_tibber:   Grundpreis: 16.09 ‚Ç¨/Monat
INFO:src.Webscraping.scraper_tibber:   Arbeitspreis: 15.25 ct/kWh
INFO:app:‚úÖ Tibber-Scraper erfolgreich: 87.26 ‚Ç¨/Monat
INFO:     127.0.0.1:37414 - "POST /api/scrape/tibber HTTP/1.1" 200 OK
